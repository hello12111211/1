<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Chat App</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #messages { margin-bottom: 20px; }
    .message { margin: 10px 0; }
    .reaction { cursor: pointer; margin-left: 5px; }
    .admin-btn { margin-left: 10px; color: red; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Live Chat 💬</h1>

  <!-- Admin login form -->
  <div id="adminLogin">
    <input type="email" id="adminEmail" placeholder="Admin email" />
    <input type="password" id="adminPassword" placeholder="Password" />
    <button onclick="adminLogin()">Login as Admin</button>
  </div>

  <div id="messages"></div>
  <input id="msgInput" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>

  <script>
   const firebaseConfig = {
      apiKey: "AIzaSyDkxI_b0O7gU-13LDxSedJIrcaBXN1UV24",
      authDomain: "project-7865777163369990472.firebaseapp.com",
      databaseURL: "https://project-7865777163369990472-default-rtdb.firebaseio.com", // Updated databaseURL
      projectId: "project-7865777163369990472",
      storageBucket: "project-7865777163369990472.appspot.com", // Corrected storageBucket URL
      messagingSenderId: "312681869598",
      appId: "1:312681869598:web:07d47a8a268fb4f5d6990f",
      measurementId: "G-QPD0FBW5KW"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let userId = null;
    let isAdmin = false;
    const adminEmail = "thomasdaly1211@gmail.com"; // 👈 Change this to your real admin email

    // Anonymous login for normal users
    auth.signInAnonymously().then(user => {
      userId = user.user.uid;
      setupMessageListener();
    });

    // Admin login function
    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(user => {
          userId = user.user.uid;
          if (user.user.email === adminEmail) {
            isAdmin = true;
            alert("Admin mode enabled ✅");
          }
          setupMessageListener();
        })
        .catch(error => alert("Login failed: " + error.message));
    }

    function sendMessage() {
      const text = document.getElementById('msgInput').value;
      if (!text) return;
      db.ref('messages').push({ text, uid: userId, reactions: {} });
      document.getElementById('msgInput').value = '';
    }

    function setupMessageListener() {
      db.ref('messages').on('value', snapshot => {
        const messages = snapshot.val();
        const msgDiv = document.getElementById('messages');
        msgDiv.innerHTML = '';
        for (let id in messages) {
          const msg = messages[id];
          const div = document.createElement('div');
          div.className = 'message';
          div.innerHTML = `<b>${msg.uid === userId ? 'You' : 'User'}</b>: ${msg.text}`;

          const emojiList = ['👍', '😂', '❤️'];
          emojiList.forEach(emoji => {
            const span = document.createElement('span');
            span.className = 'reaction';
            span.innerText = `${emoji} ${msg.reactions?.[emoji] || 0}`;
            span.onclick = () => addReaction(id, emoji);
            div.appendChild(span);
          });

          if (isAdmin) {
            const del = document.createElement('span');
            del.className = 'admin-btn';
            del.innerText = '🗑️';
            del.onclick = () => db.ref('messages/' + id).remove();
            div.appendChild(del);
          }

          msgDiv.appendChild(div);
        }
      });
    }

    function addReaction(msgId, emoji) {
      const ref = db.ref('messages/' + msgId + '/reactions/' + emoji);
      ref.transaction(curr => (curr || 0) + 1);
    }
  </script>
</body>
</html>
